package resolver

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.78

import (
	"context"
	"fmt"
	"sheng-go-backend/ent"
	"sheng-go-backend/pkg/entity/model"
)

// TriggerProfileFetch is the resolver for the triggerProfileFetch field.
func (r *mutationResolver) TriggerProfileFetch(ctx context.Context) (*ent.JobExecutionHistory, error) {
	history, err := r.controller.JobExecution.TriggerProfileFetch(ctx)
	if err != nil {
		return nil, fmt.Errorf("failed to trigger profile fetch: %w", err)
	}
	return history, nil
}

// JobExecutionHistory is the resolver for the jobExecutionHistory field.
func (r *queryResolver) JobExecutionHistory(ctx context.Context, jobName *string, limit *int, where *ent.JobExecutionHistoryWhereInput) ([]*ent.JobExecutionHistory, error) {
	historyLimit := 50 // Default limit
	if limit != nil && *limit > 0 {
		historyLimit = *limit
	}

	history, err := r.controller.JobExecution.List(ctx, jobName, historyLimit, where)
	if err != nil {
		return nil, fmt.Errorf("failed to get job execution history: %w", err)
	}
	return history, nil
}

// LatestJobExecution is the resolver for the latestJobExecution field.
func (r *queryResolver) LatestJobExecution(ctx context.Context, jobName string) (*ent.JobExecutionHistory, error) {
	execution, err := r.controller.JobExecution.GetLatest(ctx, jobName)
	if err != nil {
		return nil, fmt.Errorf("failed to get latest job execution: %w", err)
	}
	return execution, nil
}

// JobStats is the resolver for the jobStats field.
func (r *queryResolver) JobStats(ctx context.Context, jobName string, days *int) (*model.JobStats, error) {
	statsDays := 30 // Default to 30 days
	if days != nil && *days > 0 {
		statsDays = *days
	}

	stats, err := r.controller.JobExecution.GetStats(ctx, jobName, statsDays)
	if err != nil {
		return nil, fmt.Errorf("failed to get job stats: %w", err)
	}
	return stats, nil
}
