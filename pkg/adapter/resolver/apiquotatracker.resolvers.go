package resolver

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.78

import (
	"context"
	"fmt"
	"sheng-go-backend/ent"
)

// SetQuotaOverride is the resolver for the setQuotaOverride field.
func (r *mutationResolver) SetQuotaOverride(ctx context.Context, enabled bool) (*ent.APIQuotaTracker, error) {
	tracker, err := r.controller.APIQuota.SetOverride(ctx, enabled)
	if err != nil {
		return nil, fmt.Errorf("failed to set quota override: %w", err)
	}
	return tracker, nil
}

// UpdateQuotaLimit is the resolver for the updateQuotaLimit field.
func (r *mutationResolver) UpdateQuotaLimit(ctx context.Context, limit int) (*ent.APIQuotaTracker, error) {
	tracker, err := r.controller.APIQuota.UpdateLimit(ctx, limit)
	if err != nil {
		return nil, fmt.Errorf("failed to update quota limit: %w", err)
	}
	return tracker, nil
}

// CurrentQuotaStatus is the resolver for the currentQuotaStatus field.
func (r *queryResolver) CurrentQuotaStatus(ctx context.Context) (*ent.APIQuotaTracker, error) {
	tracker, err := r.controller.APIQuota.GetCurrent(ctx)
	if err != nil {
		return nil, fmt.Errorf("failed to get current quota status: %w", err)
	}
	return tracker, nil
}

// QuotaHistory is the resolver for the quotaHistory field.
func (r *queryResolver) QuotaHistory(ctx context.Context, limit *int) ([]*ent.APIQuotaTracker, error) {
	historyLimit := 12 // Default to 12 months
	if limit != nil && *limit > 0 {
		historyLimit = *limit
	}

	history, err := r.controller.APIQuota.GetHistory(ctx, historyLimit)
	if err != nil {
		return nil, fmt.Errorf("failed to get quota history: %w", err)
	}
	return history, nil
}
